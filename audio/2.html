<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Èü≥È¢ëÊí≠ÊîæÂô®</title>
    <!--ÂºïÂÖ•plyrÊí≠ÊîæÂô®ÁöÑcssÊñá‰ª∂-->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.6.8/plyr.css" />
    <!--Ëá™ÂÆö‰πâÊ†∑Âºè-->
    <style>
        body {
            font-family: 'ÂæÆËΩØÈõÖÈªë', sans-serif;
            background-color: #f1f1f1;
            margin: 0;
            padding: 0;
        }
        
        .audio-player-container {
            width: 100%;
            position: fixed;
            bottom: 0;
            left: 0;
        }

        .audio-player {
            margin: 0 auto;
            width: 90%;
            max-width: 800px;
            background-color: #f1f1f1;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
        }

        .audio-item {
            cursor: pointer;
            margin: 10px 0;
            padding: 4px 10px;
            transition: all .3s ease;
            border-radius: 3px;
            width: 40%;
            float: left;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .audio-item:hover {
            background-color: #f1f1f1;
        }

        .audio-item.active {
            background-color: #444;
            color: #fff;
        }

        .playlist-container {
            margin-top: 30px;
            padding: 10px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,.2);
            border-radius: 5px;
            width: 30%;
            float: left;
            height: calc(100vh - 230px);
            overflow-y: scroll;
        }

        .playlist-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .lyric-container {
            margin-top: 30px;
            padding: 10px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,.2);
            border-radius: 5px;
            width: 60%;
            float: left;
            overflow-y: scroll;
            height: calc(100vh - 230px);
        }

        .lyric-line {
            padding: 5px 10px;
            transition: all .3s ease;
        }

        .lyric-line.current {
            color: #f60;
            background-color: #f1f1f1;
            font-weight: bold;
        }

        .plyr--audio .plyr__controls {
            cursor: pointer;
        }

        .play-mode {
            cursor: pointer;
            font-size: 24px;
            color: #444;
        }

        .play-mode:hover {
            color: #f60;
        }
    </style>
</head>
<body>
    <div class="playlist-container">
        <div class="playlist-title">Èü≥È¢ëÂàóË°®</div>
        <div id="audio-list"></div>
    </div>
    <div class="lyric-container">
        <div class="playlist-title">Ê≠åËØç</div>
        <div id="lyric"></div>
    </div>
    <div class="audio-player-container">
        <div class="audio-player">
            <audio id="audio-player" controls></audio>
            <span id="play-mode" title="ÂàáÊç¢Êí≠ÊîæÊ®°Âºè">üîÅ</span>
        </div>
    </div>

    <!--ÂºïÂÖ•plyrÊí≠ÊîæÂô®ÁöÑjsÊñá‰ª∂-->
    <script src="https://cdn.plyr.io/3.6.8/plyr.js"></script>
    <!--Ëá™ÂÆö‰πâjs‰ª£Á†Å-->
    <script>
        const audioPlayer = document.getElementById("audio-player");
        const audioList = document.getElementById("audio-list");
        const lyricContainer = document.getElementById("lyric");
        let currentAudioIndex = 0;
        let timer;

        // ÂÆö‰πâÈü≥È¢ëÂàóË°®Êï∞ÁªÑ
        const audioData = [
            {
                title: "‰Ω†Ë¢´È™ó‰∫Ü",
                src: "https://fast-waller.github.io/resource/mp3/nggyura.mp3",
                lyricSrc: "https://fast-waller.github.io/resource/lrc/nggyura.lrc"
            },
            {
                title: "Âπ≥Âá°‰πãË∑Ø",
                src: "https://fast-waller.github.io/resource/mp3/pfzl.mp3",
                lyricSrc: "https://fast-waller.github.io/resource/lrc/pfzl.lrc"
            },
            {
                title: "Ê≠åÊõ≤‰∏â",
                src: "audio/3.mp3",
                lyricSrc: "lyric/3.lrc"
            }
        ];

        // Ê†πÊçÆÈü≥È¢ëÊï∞ÊçÆÁîüÊàêÈü≥È¢ëÂàóË°®
        function generateAudioList() {
            audioData.forEach((item, index) => {
                const audioItem = document.createElement("div");
                audioItem.classList.add("audio-item");
                audioItem.innerText = item.title;
                if (index === currentAudioIndex) {
                    audioItem.classList.add("active");
                }
                audioItem.addEventListener("click", () => {
                    // ÂàáÊç¢Èü≥È¢ëÊ∫ê
                    currentAudioIndex = index;
                    switchAudio();
                });
                audioList.appendChild(audioItem);
            });
        }

        // Ê∏≤ÊüìÊ≠åËØç
        function renderLyric(lyric) {
            lyricContainer.innerHTML = "";
            clearInterval(timer);
            const lines = lyric.split("\n");
            const regex = /\[(\d{2}):(\d{2})\.(\d{2,3})\](.+)/;
            lines.forEach(line => {
                const matches = regex.exec(line);
                if (matches) {
                    const minutes = parseInt(matches[1]);
                    const seconds = parseInt(matches[2]);
                    const milliseconds = parseInt(matches[3]);
                    const content = matches[4];
                    const startTime = minutes * 60 + seconds + milliseconds / 1000;
                    const lineEle = document.createElement("div");
                    lineEle.classList.add("lyric-line");
                    lineEle.dataset.time = startTime;
                    lineEle.innerText = content;
                    lyricContainer.appendChild(lineEle);
                }
            });
            timer = setInterval(() => {
                const currentTime = audioPlayer.currentTime;
                const currentLine = Array.from(lyricContainer.children).find(line => {
                    return line.dataset.time <= currentTime && line.nextElementSibling && line.nextElementSibling.dataset.time > currentTime;
                });
                if (currentLine) {
                    Array.from(lyricContainer.children).forEach(line => {
                        line.classList.remove("current");
                    });
                    currentLine.classList.add("current");
                    lyricContainer.scrollTop = currentLine.offsetTop - lyricContainer.offsetHeight / 2;
                }
            }, 100);
        }

        // ÂàáÊç¢Èü≥È¢ë
        function switchAudio() {
            // ÂàáÊç¢Èü≥È¢ëÊ∫ê
            audioPlayer.src = audioData[currentAudioIndex].src;
            // ËÆæÁΩÆÊí≠ÊîæÈÄüÁéá‰∏∫1
            audioPlayer.playbackRate = 1;
            // ÁßªÈô§ÊâÄÊúâÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll(".audio-item").forEach(audioItem => {
                audioItem.classList.remove("active");
            });
            // Ê∑ªÂä†ÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll(".audio-item")[currentAudioIndex].classList.add("active");
            // Êõ¥Êñ∞Èü≥È¢ëÊ†áÈ¢ò
            document.title = audioData[currentAudioIndex].title + " - Èü≥È¢ëÊí≠ÊîæÂô®";
            // Ê∏≤ÊüìÊ≠åËØç
            getLyric();
        }

        // Ëé∑ÂèñÊ≠åËØç
        function getLyric() {
            const xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    renderLyric(xhr.responseText);
                }
            };
            xhr.open("GET", audioData[currentAudioIndex].lyricSrc);
            xhr.send();
        }

        // ÂàáÊç¢Êí≠ÊîæÊ®°Âºè
        function switchPlayMode() {
            const playModeIcon = document.getElementById("play-mode");
            if (audioPlayer.loop) {
                audioPlayer.loop = false;
                playModeIcon.innerText = "üîÅ";
            } else {
                audioPlayer.loop = true;
                playModeIcon.innerText = "üîÇ";
            }
        }

        // ÂàùÂßãÂåñ
        function init() {
            generateAudioList();
            switchAudio();
            const player = new Plyr("#audio-player");
            const playModeButton = document.getElementById("play-mode");
            playModeButton.addEventListener("click", () => {
                switchPlayMode();
            });
            audioPlayer.addEventListener("ended", () => {
                currentAudioIndex = (currentAudioIndex + 1) % audioData.length;
                switchAudio();
            });
        }

        window.onload = init;
    </script>
</body>
</html>
